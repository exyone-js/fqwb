# 风琴五笔输入法修改计划

## 2. 代码结构优化

### 2.1 目录结构重构

创建更清晰的目录结构，分离不同功能模块：

```
fqwb/
├── Program.cs             # 程序入口
├── input.cs               # 输入界面实现
├── input.Designer.cs      # 窗口设计代码
├── input.resx             # 资源文件
├── dictionary.fs          # 词库服务模块
├── config.fs              # 配置管理模块
├── fuzzy_sound.fs         # 模糊音处理模块
├── history.fs             # 历史记录管理模块
├── setting.cs             # 设置界面模块
├── build.bat              # 构建脚本
├── fqwb_tsf.h             # C++ TSF接口头文件
├── fqwb_tsf.cpp           # C++ TSF接口实现文件
├── fqwb_tsf_example.cpp   # C++ TSF示例文件
├── CMakeLists.txt         # C++项目构建配置
├── dictionary.fsproj      # F#项目文件
├── fqwb.csproj            # C#项目文件
├── fqwb.sln               # 解决方案文件
└── Data/                  # 词库等用户自定义文件目录
    └── example.dic        # 示例词库文件
```

### 2.2 跨语言交互实现

建立C++、C#和F#代码之间的交互机制：

1. **C#调用C++**: 使用P/Invoke机制
2. **C#调用F#**: 通过.NET程序集引用（已实现）
3. **C++调用F#**: 通过C++/CLI桥接

## 3. 新功能实现

### 3.1 配置管理功能 (已实现)

实现统一的配置管理系统：

1. 创建ConfigManager类管理配置数据
2. 定义InputMethodConfig数据结构存储配置项
3. 实现配置的保存和加载功能
4. 支持功能开关、参数设置和快捷键配置

### 3.2 模糊音处理功能 (已实现)

实现模糊音输入支持：

1. 创建FuzzySoundProcessor类处理模糊音
2. 定义默认模糊音映射表
3. 实现编码变体生成和模糊音搜索
4. 支持模糊音功能开关控制

### 3.3 历史记录管理功能 (已实现)

实现用户输入习惯记录和智能排序：

1. 创建HistoryManager类管理历史记录
2. 实现输入记录和使用频率统计
3. 支持基于历史记录的候选词排序
4. 支持历史记录开关和参数设置

### 3.4 设置界面功能 (已实现)

创建完整的设置界面：

1. 设计设置界面UI (SettingsForm类)
2. 实现配置项的保存和加载
3. 支持各种功能的开关和参数调整
4. 提供快捷键自定义功能

### 3.5 词库切换功能 (已实现)

实现多词库切换功能：

1. 增强词库管理器，支持多词库加载
2. 实现词库切换接口
3. 添加词库选择界面

### 3.6 构建脚本 (已实现)

创建批处理脚本简化项目构建和运行：

1. 支持项目构建、运行和清理操作
2. 提供交互式命令行界面
3. 显示操作结果和错误提示

### 3.7 更换皮肤功能

实现支持自定义皮肤的功能：

1. 创建皮肤管理器类
2. 定义皮肤文件格式
3. 实现皮肤加载和应用机制
4. 添加皮肤切换界面

### 3.8 四码上屏功能

实现四码自动上屏的功能：

1. 修改输入处理逻辑，支持四码后自动上屏
2. 添加配置选项，允许用户开关此功能

### 3.9 Shift选择重码

实现使用Shift键选择重码的功能：

1. 修改按键处理逻辑，支持Shift+数字键选择重码
2. 添加配置选项，允许用户自定义此功能

### 3.10 翻页功能

完善候选词翻页功能：

1. 实现候选词分页显示
2. 支持PageUp/PageDown或其他快捷键翻页
3. 添加翻页指示器

## 4. 实现步骤

### 阶段一：基础修改 (已完成)

1. 修改输入法名称为"风琴五笔"
2. 重构项目目录结构
3. 优化CMake构建配置

### 阶段二：核心功能实现 (部分完成)

1. 完善TSF接口实现
2. 实现基本输入功能 (已完成)
3. 实现词库管理功能 (已完成)
4. 实现词库切换功能 (已完成)

### 阶段三：扩展功能实现 (部分完成)

1. 实现配置管理功能 (已完成)
2. 实现模糊音处理功能 (已完成)
3. 实现历史记录管理功能 (已完成)
4. 创建设置界面 (已完成)
5. 创建构建脚本 (已完成)
6. 实现皮肤更换功能
7. 实现四码上屏功能
8. 实现Shift选择重码功能
9. 实现翻页功能

### 阶段四：集成与测试 (进行中)

1. 整合C++、C#和F#代码
2. 进行功能测试
3. 修复Bug和优化性能

## 5. 注意事项

1. 保持代码的向后兼容性
2. 确保多语言组件之间的正确交互
3. 遵循Windows输入法开发的最佳实践

4. 确保代码的可维护性和可扩展性
