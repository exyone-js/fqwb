# 风琴五笔输入法

这是风琴五笔输入法，一款基于.NET和C++开发的中文输入法，同时支持Windows TSF接口实现。

## 项目概述

本项目是一个功能完整的输入法实现，使用C#和F#开发，旨在提供灵活、可配置的中文输入体验。项目集成了词库管理、模糊音处理、历史记录管理和用户配置等功能，可以根据用户需求进行定制化设置。

## 功能特点

- **基础输入功能**：支持编码输入和候选词选择
- **词库管理**：支持多个词库切换，可添加自定义词汇
- **模糊音处理**：支持平翘舌、前后鼻音等模糊音输入
- **历史记录**：智能学习用户输入习惯，优化候选词排序
- **配置管理**：提供丰富的设置选项，可自定义快捷键和功能
- **简洁界面**：友好的用户界面，支持功能开关和设置访问
- **Windows TSF支持**：同时提供C++ TSF接口实现

## 项目结构

```
fqwb/
├── Program.cs             # 程序入口
├── input.cs               # 输入界面实现
├── input.Designer.cs      # 窗口设计代码
├── input.resx             # 资源文件
├── dictionary.fs          # 词库服务模块
├── config.fs              # 配置管理模块
├── fuzzy_sound.fs         # 模糊音处理模块
├── history.fs             # 历史记录管理模块
├── setting.cs             # 设置界面模块
├── build.bat              # 构建脚本
├── fqwb_tsf.h             # C++ TSF接口头文件
├── fqwb_tsf.cpp           # C++ TSF接口实现文件
├── fqwb_tsf_example.cpp   # C++ TSF示例文件
├── CMakeLists.txt         # C++项目构建配置
├── dictionary.fsproj      # F#项目文件
├── fqwb.csproj            # C#项目文件
├── fqwb.sln               # 解决方案文件
└── Data/                  # 词库等用户自定义文件目录
    └── example.dic        # 示例词库文件
```

## 功能说明

1. **基本输入功能**：
   - 输入编码后按空格键显示候选词
   - 使用数字键1-9选择候选词
   - 使用Enter键确认选择的候选词
   - 使用Esc键清除当前输入或关闭候选词列表
   - 使用退格键删除最后输入的字符

2. **词库管理**：
   - 支持多个词库文件的加载和切换
   - 词库文件位于Data/目录下，支持.dic和.txt格式
   - 词库格式：编码+空格+输出的字符（例如：shili 示例）
   - 程序首次运行时会自动创建默认词库和示例词库
   - 支持添加自定义词汇到用户词库

3. **模糊音处理**：
   - 支持平翘舌音（如zh/z、ch/c、sh/s）
   - 支持前后鼻音（如an/ang、en/eng、in/ing）
   - 支持其他常见模糊音组合
   - 可以通过界面开关控制模糊音功能

4. **历史记录**：
   - 记录用户输入习惯和使用频率
   - 根据使用频率调整候选词排序
   - 可以设置最大记录数量和最小使用次数
   - 可以通过界面开关控制历史记录功能

5. **配置管理**：
   - 自动保存和加载用户配置
   - 支持自定义快捷键
   - 提供可视化设置界面
   - 配置项包括：功能开关、参数设置、快捷键定义

## 使用方法

### 基础输入

1. 运行程序后，输入法界面会显示在屏幕上
2. 在编码输入框中输入相应的编码
3. 按下空格键显示候选词
4. 使用数字键1-9选择对应的候选词
5. 选中的候选词会被复制到剪贴板

### 快捷键

- **空格键**：显示候选词
- **ESC键**：清除当前输入
- **Enter键**：确认选择第一个候选词
- **数字键1-9**：选择对应的候选词
- **减号键**：翻页功能（开发中）

### 功能控制

在界面上可以直接控制以下功能：
- 模糊音开关
- 历史记录开关
- 设置按钮（打开设置界面）

### 设置界面

通过点击设置按钮可以访问完整的设置界面，包括：

- **基本设置**：模糊音、历史记录等功能开关和参数设置
- **快捷键设置**：自定义各种操作的快捷键

## 自定义词库

你可以直接编辑Data/目录下的词库文件来添加、修改或删除词语。每行一个词条，格式为：
```
编码 对应的词语
```

例如：
```
hello 你好
world 世界
```

修改词库后，需要重新启动程序才能生效。

## 安装说明

### 前提条件

- [.NET 8 SDK](https://dotnet.microsoft.com/zh-cn/download/dotnet/8.0) 或更高版本
- Visual Studio 2022 或其他兼容的开发工具

### 安装步骤

1. 克隆或下载项目代码
2. 使用Visual Studio打开解决方案文件 `fqwb.sln`
3. 还原项目依赖：`dotnet restore`
4. 构建项目：`dotnet build`
5. 运行项目：`dotnet run`

或者使用项目中提供的构建脚本：

```batch
build.bat
```

然后按照脚本提示选择相应的操作。

## C++ TSF接口说明

本项目同时提供了C++ TSF (Text Service Framework) 接口实现，这是Windows系统上输入法的标准实现方式。

### 主要组件

- **dictionary_manager**：词库管理器，负责加载和管理词库
- **fqwb_input_method**：输入法核心类，处理输入逻辑和候选词生成
- **fqwb_text_service**：TSF文本服务类，实现Windows TSF接口

### 编译方法

使用CMake构建C++项目：

```bash
mkdir build
cd build
cmake ..
cmake --build . --config Release
```

### 开发者如何调用

1. 包含头文件：`#include "fqwb_tsf.h"`
2. 创建输入法实例：`fqwb_input_method* im = new fqwb_input_method();`
3. 初始化：`im->initialize(data_dir);`
4. 处理键盘输入：`im->process_key_input(key_code, is_down, &handled);`
5. 获取候选词：`const std::vector<std::wstring>& candidates = im->get_candidates();`
6. 选择候选词：`std::wstring selected = im->select_candidate(index);`

### 构建和运行

生成的DLL文件可以注册为Windows输入法组件，提供系统级的输入法支持。

## 开发指南

### 添加新功能

1. 创建新的功能模块文件
2. 在需要使用的地方引用该模块
3. 更新界面以集成新功能
4. 在设置界面中添加相应的配置选项

## 贡献说明

欢迎提交Issue和Pull Request来改进项目。在贡献代码前，请确保：

1. 代码符合项目的编码规范
2. 添加必要的注释和文档
3. 测试代码的功能和稳定性

## 许可证

本项目采用GPL许可证。

## 联系方式


如有任何问题或建议，请联系项目维护者。
